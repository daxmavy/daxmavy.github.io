<section class="newsletter">
  <h3>Subscribe to Newsletter</h3>
  <p>Get notified when I publish new posts.</p>

  <form action="https://buttondown.email/api/emails/embed-subscribe/daxmavy"
        method="post"
        class="newsletter-form"
        id="newsletter-form">
    <div class="form-group">
      <label for="bd-email">Email address:</label>
      <input type="email"
             name="email"
             id="bd-email"
             placeholder="you@example.com"
             required>
    </div>
    <button type="submit" class="button">Subscribe</button>
    <p class="form-note">Unsubscribe anytime.</p>
    <div id="newsletter-status" style="display: none; margin-top: 1rem;"></div>
  </form>
</section>

<script>
(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('newsletter-form');
    const status = document.getElementById('newsletter-status');

    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();

        const email = form.querySelector('input[name="email"]').value;
        const formData = new FormData();
        formData.append('email', email);

        // Disable submit button
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Subscribing...';

        fetch(form.action, {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        })
        .then(function() {
          // Success (no-cors means we can't read the response, but if no error thrown, it worked)
          status.style.display = 'block';
          status.style.color = 'var(--color-secondary)';
          status.textContent = 'âœ“ Thanks for subscribing! Check your email to confirm.';
          form.querySelector('input[name="email"]').value = '';
          submitBtn.textContent = 'Subscribed!';

          setTimeout(function() {
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            status.style.display = 'none';
          }, 5000);
        })
        .catch(function(error) {
          // Error
          status.style.display = 'block';
          status.style.color = 'var(--color-muted)';
          status.textContent = 'Something went wrong. Please try again.';
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        });
      });
    }
  });
})();
</script>
