{{ define "main" }}
<article class="research-page">
  <header>
    <h1>{{ .Title }}</h1>
  </header>

  <div class="content">
    {{ if .Params.research_interests }}
    <div class="research-interests">
      {{ .Params.research_interests | markdownify }}
    </div>
    {{ end }}

    {{ if .Params.current_projects }}
    <section class="research-section">
      <h2>Current Projects</h2>
      <div class="research-items">
        {{ range $index, $project := .Params.current_projects }}
        <div class="research-item collapsible">
          <div class="research-item-header clickable" data-target="project-{{ $index }}">
            <div class="research-item-title-row">
              <h3 class="research-item-title">
                {{ if .link }}
                <a href="{{ .link }}" target="_blank" rel="noopener" onclick="event.stopPropagation()">{{ .title }}</a>
                {{ else }}
                {{ .title }}
                {{ end }}
              </h3>
              <span class="expand-icon">+</span>
            </div>
            <span class="research-item-date">{{ .date }}</span>
          </div>
          <div id="project-{{ $index }}" class="research-item-abstract collapsed">
            {{ .abstract | markdownify }}
          </div>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{ if .Params.publications }}
    <section class="research-section">
      <h2>Publications</h2>
      <div class="research-items">
        {{ range $index, $pub := .Params.publications }}
        <div class="research-item collapsible">
          <div class="research-item-header clickable" data-target="pub-{{ $index }}">
            <div class="research-item-title-row">
              <h3 class="research-item-title">
                {{ if .link }}
                <a href="{{ .link }}" target="_blank" rel="noopener" onclick="event.stopPropagation()">{{ .title }}</a>
                {{ else }}
                {{ .title }}
                {{ end }}
              </h3>
              <span class="expand-icon">+</span>
            </div>
            <div class="research-item-meta">
              <span class="research-item-date">{{ .date }}</span>
              {{ if .venue }}
              <span class="research-item-venue">{{ .venue }}</span>
              {{ end }}
            </div>
          </div>
          <div id="pub-{{ $index }}" class="research-item-abstract collapsed">
            {{ .abstract | markdownify }}
          </div>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{ if .Params.working_papers }}
    <section class="research-section">
      <h2>Working Papers</h2>
      <div class="research-items">
        {{ range $index, $paper := .Params.working_papers }}
        <div class="research-item collapsible">
          <div class="research-item-header clickable" data-target="paper-{{ $index }}">
            <div class="research-item-title-row">
              <h3 class="research-item-title">
                {{ if .link }}
                <a href="{{ .link }}" target="_blank" rel="noopener" onclick="event.stopPropagation()">{{ .title }}</a>
                {{ else }}
                {{ .title }}
                {{ end }}
              </h3>
              <span class="expand-icon">+</span>
            </div>
            <span class="research-item-date">{{ .date }}</span>
          </div>
          <div id="paper-{{ $index }}" class="research-item-abstract collapsed">
            {{ .abstract | markdownify }}
          </div>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{ .Content }}
  </div>
</article>

<script>
// Handle collapsible research items
document.addEventListener('DOMContentLoaded', function() {
  const headers = document.querySelectorAll('.research-item-header.clickable');

  headers.forEach(header => {
    header.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const abstract = document.getElementById(targetId);
      const icon = this.querySelector('.expand-icon');

      if (abstract.classList.contains('collapsed')) {
        abstract.classList.remove('collapsed');
        abstract.classList.add('expanded');
        icon.textContent = 'âˆ’';
      } else {
        abstract.classList.add('collapsed');
        abstract.classList.remove('expanded');
        icon.textContent = '+';
      }
    });
  });
});
</script>
{{ end }}
