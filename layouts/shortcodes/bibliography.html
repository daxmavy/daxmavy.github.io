{{- $filter := .Get 0 -}}
{{- $bib := .Site.Data.bibliography -}}

<section class="bibliography">
  <h2>References</h2>
  <div class="publications">
    {{- range $key, $entry := $bib -}}
    <div class="publication-item">
      <div class="pub-title">{{ $entry.title }}</div>
      <div class="pub-authors">{{ $entry.author }}</div>
      <div class="pub-venue">
        {{- if $entry.journal -}}
          <em>{{ $entry.journal }}</em>
          {{- if $entry.volume -}}, Vol. {{ $entry.volume }}{{ end -}}
          {{- if $entry.issue -}}({{ $entry.issue }}){{ end -}}
          {{- if $entry.pages -}}, pp. {{ $entry.pages }}{{ end -}}
        {{- end -}}
        {{- if $entry.publisher -}}
          {{ $entry.publisher }}
        {{- end -}}
        {{- if $entry.year -}}, {{ $entry.year }}{{ end -}}
      </div>

      <div class="pub-links">
        {{- if $entry.doi -}}
          <a href="https://doi.org/{{ $entry.doi }}" target="_blank">DOI</a>
        {{- end -}}
        {{- if $entry.url -}}
          <a href="{{ $entry.url }}" target="_blank">URL</a>
        {{- end -}}
        {{- if $entry.pdf -}}
          <a href="{{ $entry.pdf }}" target="_blank">PDF</a>
        {{- end -}}
        {{- if $entry.abstract -}}
          <button class="abstract-toggle" data-target="abstract-{{ $key }}" aria-expanded="false">
            Show Abstract
          </button>
        {{- end -}}
      </div>

      {{- if $entry.abstract -}}
      <div id="abstract-{{ $key }}" class="publication-abstract">
        {{ $entry.abstract }}
      </div>
      {{- end -}}
    </div>
    {{- end -}}
  </div>
</section>

<script>
(function() {
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.abstract-toggle');

    toggleButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const abstract = document.getElementById(targetId);
        const isExpanded = this.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
          abstract.classList.remove('show');
          this.setAttribute('aria-expanded', 'false');
          this.textContent = 'Show Abstract';
        } else {
          abstract.classList.add('show');
          this.setAttribute('aria-expanded', 'true');
          this.textContent = 'Hide Abstract';
        }
      });
    });
  });
})();
</script>
